/* app/globals.css */
:root {
  --bg:#fff; --text:#0f172a; --muted:#64748b; --panel:#f8fafc; --border:#e5e7eb;
  --brand:#111827; --brand-weak:#334155; --accent:#0ea5e9;
  --bubble-user:#e0f2fe; --bubble-assistant:#f4f4f5;
}
@media (prefers-color-scheme: dark) {
  :root {
    --bg:#0b0f17; --text:#e5e7eb; --muted:#94a3b8; --panel:#0f172a; --border:#1f2937;
    --brand:#e5e7eb; --brand-weak:#cbd5e1; --accent:#38bdf8;
    --bubble-user:#0b2b3a; --bubble-assistant:#111827;
  }
}
html, body { height: 100%; }
* { box-sizing: border-box; }
body {
  margin: 0; background: var(--bg); color: var(--text);
  font: 16px/1.45 system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
}

/* —— App frame on <body> —— */
.app {
  height: 100dvh;
  display: grid;
  grid-template-columns: 280px minmax(0, 1fr); /* <- ensure the main column can shrink */
  min-width: 0; /* avoid overflow */
}

/* Sidebar */
.sidebar {
  border-right: 1px solid var(--border);
  background: var(--panel);
  display: grid;
  grid-template-rows: auto 1fr auto;
  min-height: 0;
}
.side-top { padding: 12px; display: grid; gap: 8px; }
.brand { font-weight: 800; color: var(--brand); }
.btn {
  display: inline-flex; align-items: center; gap: 8px;
  padding: 10px 12px; border: 1px solid var(--border);
  background: var(--bg); color: var(--text); border-radius: 12px; cursor: pointer;
}
.btn.primary { background: var(--brand); color: #fff; border-color: var(--brand); }
.btn.ghost { background: transparent; }
.btn:disabled { opacity:.6; cursor:not-allowed; }
.chat-list { overflow:auto; padding: 8px 12px; display:grid; gap:6px; }
.chat-item { padding: 8px 10px; border:1px solid var(--border); border-radius:10px; color:var(--brand-weak); cursor:pointer; }
.chat-item:hover { border-color:var(--accent); color:var(--text); }
.side-bottom { padding:12px; border-top:1px solid var(--border); display:grid; gap:8px; }

/* Main column */
.main {
  display: grid;
  grid-template-rows: auto 1fr auto;
  min-width: 0; /* critical for grids */
}
.header {
  position: sticky; top: 0; z-index: 10;
  border-bottom: 1px solid var(--border);
  background: color-mix(in oklab, var(--bg) 92%, transparent);
  backdrop-filter: blur(6px);
}
.header-inner {
  max-width: 980px; margin: 0 auto; padding: 10px 16px;
  display: flex; align-items: center; gap: 10px;
}
.controls { margin-left: auto; display:flex; gap:8px; }
select, input[type="number"], input[type="text"] {
  padding: 8px 10px; border:1px solid var(--border); border-radius:10px;
  background: var(--bg); color: var(--text);
}

/* Chat area */
.scroll { overflow-y: auto; min-height: 0; }
.center { max-width: 980px; margin: 0 auto; padding: 12px 16px; }
.messages { display: grid; gap: 12px; }

/* Bubbles */
.bubble { display:flex; gap:10px; align-items:flex-start; }
.avatar {
  width: 28px; height: 28px; border-radius:999px; display:grid; place-items:center;
  color:#fff; font-size:14px; font-weight:700; flex:0 0 auto;
}
.avatar.user { background: var(--accent); }
.avatar.bot { background: var(--brand); }
.balloon {
  border:1px solid var(--border); border-radius:16px; padding:10px 12px;
  max-width: 760px; white-space: pre-wrap;
}
.balloon.user { background: var(--bubble-user); }
.balloon.bot  { background: var(--bubble-assistant); }

/* Meta + panels */
.meta { font-size:12px; color:var(--muted); display:flex; gap:8px; flex-wrap:wrap; }
.panel { background:var(--panel); border:1px solid var(--border); border-radius:10px; padding:10px; }

/* Composer */
.composer { border-top:1px solid var(--border); background: var(--panel); }
.composer-inner {
  max-width:980px; margin:0 auto; padding:12px 16px;
  display:grid; grid-template-columns: 1fr auto; gap:8px;
}
.input { padding:12px; border:1px solid var(--border); border-radius:12px; background:var(--bg); color:var(--text); }

/* Collapse sidebar on narrow screens */
@media (max-width: 920px) {
  .app { grid-template-columns: 1fr; }
  .sidebar { display: none; }
}
/* ========== UI skin pass 1 (ADD-ONLY; no overrides to existing rules) ========== */

/* 1) Code & Pre: clear, readable blocks (light + dark) */
pre, code {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
}
pre {
  background: #0a0a0a;
  color: #e5e7eb;
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px 14px;
  overflow: auto;
}
code:not(pre code) {
  background: #f1f5f9;
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 0.15rem 0.35rem;
}
@media (prefers-color-scheme: dark) {
  code:not(pre code) {
    background: #0f172a;
    color: #e5e7eb;
    border-color: #1f2937;
  }
}

/* 2) Focus states: inputs/buttons more visible without harsh colors */
select:focus,
input[type="number"]:focus,
input[type="text"]:focus,
textarea:focus,
button:focus {
  outline: none;
  box-shadow: 0 0 0 3px color-mix(in oklab, var(--accent) 20%, transparent);
  border-color: color-mix(in oklab, var(--accent) 40%, var(--border));
}

/* 3) Subtle elevation for bubbles (keeps your colors as-is) */
.balloon {
  box-shadow: 0 1px 2px rgba(0,0,0,.04), 0 4px 12px rgba(0,0,0,.04);
}
/* smoother flow between messages */
.messages {
  gap: 16px; /* was 12px */
  padding-bottom: 40px; /* leaves air above composer */
}
/* soften sidebar divide and make hover feel tactile */
.sidebar {
  border-right: 1px solid color-mix(in oklab, var(--border) 70%, transparent);
}
.chat-item:hover {
  background: color-mix(in oklab, var(--accent) 6%, var(--panel));
  transform: translateY(-1px);
  transition: background 0.2s ease, transform 0.15s ease;
}
/* floating composer feel */
.composer {
  position: sticky;
  bottom: 0;
  z-index: 5;
  box-shadow: 0 -2px 10px rgba(0,0,0,0.04);
  border-top: 1px solid color-mix(in oklab, var(--border) 80%, transparent);
}
.input {
  border-radius: 20px;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}
.input:focus {
  border-color: color-mix(in oklab, var(--accent) 40%, var(--border));
  box-shadow: 0 0 0 3px color-mix(in oklab, var(--accent) 20%, transparent);
}
/* ========== UI pass 3: avatars + spacing (append-only) ========== */

/* 1) Avatar polish: size, ring, legible initials */
.avatar {
  width: 32px;
  height: 32px;
  font-size: 13px;
  box-shadow: 0 1px 2px rgba(0,0,0,.06);
  border: 0; /* keep backgrounds from your vars */
}
@media (max-width: 920px) {
  .avatar { width: 28px; height: 28px; font-size: 12px; }
}
/* soft rings that match your brand/accent without changing fills */
.avatar.user {
  box-shadow:
    inset 0 0 0 2px color-mix(in oklab, var(--accent) 65%, transparent),
    0 1px 2px rgba(0,0,0,.06);
}
.avatar.bot {
  box-shadow:
    inset 0 0 0 2px color-mix(in oklab, var(--brand) 60%, transparent),
    0 1px 2px rgba(0,0,0,.06);
}

/* 2) Bubble geometry & rhythm: a touch more air, stable max widths */
.bubble { gap: 12px; align-items: flex-start; }
.balloon {
  border-radius: 18px;            /* slightly softer than 16px */
  padding: 12px 14px;             /* more comfortable read */
  line-height: 1.6;
  max-width: 760px;               /* keep your previous cap */
}
@media (min-width: 1200px) {
  .balloon { max-width: 820px; }  /* breathe on larger screens */
}
@media (max-width: 480px) {
  .balloon { max-width: calc(100% - 64px); } /* protect against edge collisions */
}

/* 3) Gentle grouping: de-emphasize repeated avatars for same speaker */
.bubble.user + .bubble.user .avatar,
.bubble.bot  + .bubble.bot  .avatar {
  visibility: hidden;             /* preserves layout width; reduces noise */
}
.bubble.user + .bubble.user,
.bubble.bot  + .bubble.bot {
  margin-top: -4px;               /* tucks consecutive messages closer */
}
/* ========== UI pass 4: footer/meta info (append-only) ========== */

/* footer strip pinned below composer */
.footer-meta {
  font-size: 12px;
  color: var(--muted);
  text-align: center;
  padding: 10px 16px;
  border-top: 1px solid var(--border);
  background: var(--panel);
}

/* fade in subtly when scrolling to bottom */
.footer-meta {
  opacity: 0.85;
  transition: opacity 0.3s ease;
}
.footer-meta:hover {
  opacity: 1;
}
/* ========== UI hotfix: footer placement & sizing (append-only) ========== */
.footer-meta {
  grid-column: 1 / -1;    /* span both grid columns of .app */
  position: static;       /* avoid odd sticky behavior in grid */
  font-size: 12px;        /* ensure small, not oversized */
  line-height: 1.4;
  padding: 10px 16px;
}
/* ========== UI pass 5: mobile polish (append-only) ========== */

/* 1) Safe-area aware footer & composer for iOS/Android */
@supports (padding: max(0px)) {
  .composer,
  .footer-meta {
    padding-bottom: max(12px, env(safe-area-inset-bottom));
  }
}
.footer-meta {
  position: sticky;
  bottom: 0;
}

/* 2) Comfortable tap targets & type scale on small screens */
@media (max-width: 480px) {
  body { font-size: 15.5px; }               /* +3% readability bump */
  .btn, button, .input, select {
    min-height: 44px;                        /* thumb-friendly */
  }
  .header-inner,
  .center,
  .composer-inner {
    padding-left: 12px;
    padding-right: 12px;                     /* tighter gutters */
  }
}

/* 3) Message layout: avatars + bubbles fit small widths cleanly */
@media (max-width: 480px) {
  .avatar { width: 26px; height: 26px; font-size: 11px; }
  .bubble { gap: 10px; }
  .balloon {
    border-radius: 16px;
    padding: 10px 12px;
    max-width: calc(100% - 70px);            /* protects edges next to avatar */
    word-break: break-word;                  /* long tokens won’t overflow */
  }
  .messages { gap: 14px; }
}
/* === Incremental pass #6: dark-mode polish (append-only) === */

/* Base tokens: keep light mode as-is, only define fallbacks */
:root {
  /* if these already exist, we’re just confirming defaults */
  --bg:        #ffffff;
  --fg:        #0f172a;  /* slate-900 */
  --muted:     #64748b;  /* slate-500 */
  --border:    #e2e8f0;  /* slate-200 */

  /* chat bubbles */
  --bubble-assistant-bg: #f8fafc; /* slate-50 */
  --bubble-assistant-fg: #0f172a;
  --bubble-user-bg:      #2563eb; /* blue-600 */
  --bubble-user-fg:      #ffffff;

  /* footer */
  --footer-bg: #ffffff;
  --footer-fg: #475569;  /* slate-600 */
  --footer-border: #e2e8f0;
}

/* Auto dark mode: prefers-color-scheme */
@media (prefers-color-scheme: dark) {
  :root {
    --bg:        #0b1020; /* near-slate-950, deeper than default for contrast */
    --fg:        #e5e7eb; /* slate-200 */
    --muted:     #94a3b8; /* slate-400 */
    --border:    #1f2937; /* slate-800 */

    /* bubbles: keep >4.5:1 contrast */
    --bubble-assistant-bg: #10172a; /* slate-900-ish */
    --bubble-assistant-fg: #e5e7eb;
    --bubble-user-bg:      #3b82f6; /* blue-500 (reads better on dark) */
    --bubble-user-fg:      #0b1020; /* dark text inside bright bubble for 7+:1 */

    /* footer */
    --footer-bg: #0b1020;
    --footer-fg: #a8b1c6; /* slate-300/400 */
    --footer-border: #1f2937;
  }
}

/* Class-based dark mode (if you toggle .dark on <html> or <body>) */
.dark {
  --bg:        #0b1020;
  --fg:        #e5e7eb;
  --muted:     #94a3b8;
  --border:    #1f2937;

  --bubble-assistant-bg: #10172a;
  --bubble-assistant-fg: #e5e7eb;
  --bubble-user-bg:      #3b82f6;
  --bubble-user-fg:      #0b1020;

  --footer-bg: #0b1020;
  --footer-fg: #a8b1c6;
  --footer-border: #1f2937;
}

/* Wire tokens into existing surfaces without changing markup */
body {
  background: var(--bg);
  color: var(--fg);
}

.chat-row.assistant,
.bubble.assistant,
[data-role="assistant"] {
  background: var(--bubble-assistant-bg);
  color: var(--bubble-assistant-fg);
  border-color: var(--border);
}

.chat-row.user,
.bubble.user,
[data-role="user"] {
  background: var(--bubble-user-bg);
  color: var(--bubble-user-fg);
  border-color: transparent; /* user bubble usually no border */
}

/* Footer (server-rendered) */
.site-footer,
[data-footer] {
  background: var(--footer-bg);
  color: var(--footer-fg);
  border-top: 1px solid var(--footer-border);
}

/* Subtle focus rings for a11y on dark */
:focus-visible {
  outline: 2px solid color-mix(in oklab, var(--bubble-user-bg), white 10%);
  outline-offset: 2px;
}

/* Respect reduced motion for any existing transitions */
@media (prefers-reduced-motion: reduce) {
  * { transition: none !important; animation: none !important; }
}
/* === Incremental pass #8: sidebar visual parity (append-only) === */
/* Tokens (reuse your existing vars) */
:root {
  --sb-width:      264px;            /* full width */
  --sb-rail:       56px;             /* collapsed rail */
  --sb-row-h:      36px;             /* item height */
  --sb-radius:     8px;              /* pill radius */
  --sb-gap:        6px;              /* row gap */
  --sb-pad-x:      10px;             /* horizontal padding */
  --sb-pad-y:      8px;              /* vertical padding */
  --sb-icon:       18px;             /* icon size */
  --sb-section-fg: color-mix(in oklab, var(--fg), transparent 45%);
  --sb-hover:      color-mix(in oklab, var(--fg), var(--bg) 92%);
  --sb-active:     color-mix(in oklab, var(--bubble-user-bg), var(--bg) 85%);
}

/* Sidebar container baseline */
.sidebar {
  padding: 8px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  background: var(--sb-bg, color-mix(in oklab, var(--bg), black 4%));
}

/* Header (logo + collapse button area) */
.sidebar .sb-header {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 6px var(--sb-pad-x);
  min-height: 40px;
  border-radius: var(--sb-radius);
}

/* Section label (e.g., "Projects", "Chats") */
.sidebar .sb-section-label,
.sidebar [data-section-label] {
  font-size: 11.5px;
  font-weight: 600;
  letter-spacing: .02em;
  color: var(--sb-section-fg);
  padding: 4px var(--sb-pad-x);
  text-transform: none;             /* ChatGPT uses normal case, semi-muted */
}

/* List container spacing */
.sidebar .sb-list,
.sidebar [data-sb-list] {
  display: grid;
  gap: var(--sb-gap);
  padding: 0 var(--sb-pad-x);
}

/* Row item: icon + label pill */
.sidebar .sb-item,
.sidebar [data-sb-item] {
  display: grid;
  grid-template-columns: var(--sb-icon) 1fr auto; /* icon | label | meta */
  align-items: center;
  gap: 10px;
  height: var(--sb-row-h);
  padding: 0 8px;
  border-radius: var(--sb-radius);
  color: var(--fg);
  background: transparent;
  border: 1px solid transparent;
  cursor: pointer;
  user-select: none;
  transition: background .18s ease, border-color .18s ease, color .18s ease;
}

/* Icon */
.sidebar .sb-item .icon,
.sidebar [data-sb-item] .icon {
  inline-size: var(--sb-icon);
  block-size: var(--sb-icon);
  display: grid; place-items: center;
  color: color-mix(in oklab, var(--fg), transparent 30%);
}

/* Label text */
.sidebar .sb-item .label,
.sidebar [data-sb-item] .label {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  font-size: 13.5px;
  line-height: 1;
}

/* Meta (e.g., badge, chevron) */
.sidebar .sb-item .meta,
.sidebar [data-sb-item] .meta {
  display: grid; place-items: center;
  color: color-mix(in oklab, var(--fg), transparent 45%);
  font-size: 12px;
}

/* Hover: soft fill like ChatGPT */
.sidebar .sb-item:hover,
.sidebar [data-sb-item]:hover {
  background: var(--sb-hover);
  border-color: color-mix(in oklab, var(--border), transparent 25%);
}

/* Active/selected row: subtle pill with stronger text */
.sidebar .sb-item.is-active,
.sidebar [data-sb-item].is-active,
.sidebar .sb-item[aria-current="page"],
.sidebar [data-sb-item][aria-current="page"] {
  background: var(--sb-active);
  color: var(--fg);
  border-color: color-mix(in oklab, var(--bubble-user-bg), transparent 75%);
  font-weight: 600;
}

/* “New chat” top button styling parity */
.sidebar .sb-primary,
.sidebar [data-sb-primary] {
  margin: 4px var(--sb-pad-x) 2px;
  height: 40px;
  display: grid;
  grid-template-columns: var(--sb-icon) 1fr auto;
  align-items: center;
  gap: 12px;
  padding: 0 10px;
  border-radius: 10px;
  background: color-mix(in oklab, var(--bubble-user-bg), var(--bg) 92%);
  color: var(--fg);
  border: 1px solid color-mix(in oklab, var(--bubble-user-bg), transparent 80%);
}
.sidebar .sb-primary:hover,
.sidebar [data-sb-primary]:hover {
  background: color-mix(in oklab, var(--bubble-user-bg), var(--bg) 88%);
}

/* Divider spacing */
.sidebar .sb-divider,
.sidebar [data-sb-divider] {
  margin: 6px var(--sb-pad-x);
  border-top: 1px solid color-mix(in oklab, var(--border), transparent 20%);
}

/* “See more” inline row style */
.sidebar .sb-see-more,
.sidebar [data-sb-see-more] {
  color: color-mix(in oklab, var(--fg), transparent 35%);
  height: var(--sb-row-h);
  display: grid;
  grid-template-columns: var(--sb-icon) 1fr auto;
  align-items: center;
  gap: 10px;
  padding: 0 8px;
  border-radius: var(--sb-radius);
}
.sidebar .sb-see-more:hover,
.sidebar [data-sb-see-more]:hover {
  background: var(--sb-hover);
}

/* Chats list: slightly denser spacing like ChatGPT */
.sidebar [data-section="chats"] .sb-list,
.sidebar .sb-list.chats {
  gap: 4px;
}

/* Rail mode visual rules from pass #7 (labels hide in rail) */
html[data-sb="rail"] .sidebar .label,
html[data-sb="rail"] .sidebar [data-label] { display: none; }
html[data-sb="rail"] .sidebar .sb-item,
html[data-sb="rail"] .sidebar [data-sb-item] {
  grid-template-columns: 1fr;        /* icon centered in pill */
  justify-items: center;
  padding-inline: 0;
}

/* Dark-mode polish for sidebar specifically */
@media (prefers-color-scheme: dark) {
  .sidebar {
    background: var(--sb-bg, color-mix(in oklab, var(--bg), white 3%));
  }
  .sidebar .sb-item .icon { color: color-mix(in oklab, var(--fg), transparent 55%); }
  .sidebar .sb-item:hover { background: color-mix(in oklab, var(--fg), var(--bg) 85%); }
  .sidebar .sb-primary {
    background: color-mix(in oklab, var(--bubble-user-bg), black 80%);
    border-color: color-mix(in oklab, var(--bubble-user-bg), transparent 70%);
  }
  .sidebar .sb-primary:hover {
    background: color-mix(in oklab, var(--bubble-user-bg), black 72%);
  }
}/* === TEMP DEBUG: highlight what we think is the sidebar === */
.app > aside,
.app > nav,
.app [data-sidebar],
.app .left-rail,
.app .sidenav,
.app .sidebar {
  outline: 3px dashed hotpink !important;
  outline-offset: -2px;
}
/* === Incremental pass #8b: sidebar binding + debug outline (append-only) === */

/* TEMP DEBUG — helps identify which element is actually the sidebar */
.app > aside,
.app > nav,
.app [data-sidebar],
.app .left-rail,
.app .sidenav,
.app .sidebar {
  outline: 3px dashed hotpink !important;
  outline-offset: -2px;
}

/* Bridge rules — apply sidebar styling to whatever node matches above */
:where(
  .app > aside,
  .app > nav,
  .app [data-sidebar],
  .app .left-rail,
  .app .sidenav,
  .app .sidebar
) {
  position: sticky;
  top: 0;
  align-self: start;
  height: 100dvh;
  overflow: hidden auto;
  background: var(--sb-bg, color-mix(in oklab, var(--bg), black 4%));
  border-right: 1px solid var(--sb-border, var(--border));
  padding: 8px;
}

/* Ensure layout grid is established even if markup never had .content */
.app {
  display: grid;
  grid-template-columns: var(--sb-width, 264px) 1fr;
  min-height: 100dvh;
}
@media (max-width: 768px) {
  .app { grid-template-columns: 1fr; }
}

/* Make the element following sidebar behave as main content */
:where(
  .app > aside,
  .app > nav,
  .app [data-sidebar],
  .app .left-rail,
  .app .sidenav,
  .app .sidebar
) + * {
  min-width: 0;
  overflow: hidden;
}
/* === Incremental pass #8c: generic sidebar rows (append-only) === */

/* 0) Kill the temp debug outline from 8b */
.app > aside,
.app > nav,
.app [data-sidebar],
.app .left-rail,
.app .sidenav,
.app .sidebar {
  outline: none !important;
  outline-offset: 0;
}

/* 1) Alias: treat your actual sidebar node(s) as .sidebar */
:root {
  --sb-width: 264px;
  --sb-row-h: 38px;
  --sb-radius: 12px;
  --sb-gap: 8px;
  --sb-pad-x: 10px;
  --sb-section-fg: color-mix(in oklab, var(--fg), transparent 45%);
  --sb-hover: color-mix(in oklab, var(--fg), var(--bg) 92%);
  --sb-active: color-mix(in oklab, var(--bubble-user-bg, #3b82f6), var(--bg) 85%);
}

/* Layout grid stays intact */
.app {
  display: grid;
  grid-template-columns: var(--sb-width) 1fr;
  min-height: 100dvh;
}
@media (max-width: 768px) {
  .app { grid-template-columns: 1fr; }
}

/* 2) Sidebar base visuals */
:where(.app > aside, .app > nav, .app [data-sidebar], .app .left-rail, .app .sidenav, .app .sidebar) {
  background: var(--sb-bg, color-mix(in oklab, var(--bg), black 4%));
  border-right: 1px solid var(--sb-border, var(--border));
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

/* 3) Section labels like “Projects”, “Chats” */
:where(.app > aside, .app > nav, .app [data-sidebar], .app .left-rail, .app .sidenav, .app .sidebar)
  :is(h2, h3, [data-section-label]) {
  font-size: 11.5px;
  font-weight: 600;
  letter-spacing: .02em;
  color: var(--sb-section-fg);
  margin: 8px var(--sb-pad-x) 2px;
}

/* 4) Generic list containers */
:where(.app > aside, .app > nav, .app [data-sidebar], .app .left-rail, .app .sidenav, .app .sidebar)
  :is(nav, ul, .list, [data-sb-list]) {
  display: grid;
  gap: 6px;
  padding: 0 var(--sb-pad-x);
  margin: 0;
  list-style: none;
}

/* 5) Row pills: target anchors & buttons (no class needed) */
:where(.app > aside, .app > nav, .app [data-sidebar], .app .left-rail, .app .sidenav, .app .sidebar)
  :is(a, button, [role="button"], .row) {
  display: grid;
  grid-template-columns: 1fr auto; /* label | meta (if any) */
  align-items: center;
  height: var(--sb-row-h);
  padding: 0 10px;
  border-radius: var(--sb-radius);
  color: var(--fg);
  background: transparent;
  border: 1px solid transparent;
  text-align: left;
  text-decoration: none;
  cursor: pointer;
  user-select: none;
  transition: background .18s ease, border-color .18s ease, color .18s ease, box-shadow .18s ease;
}

/* 6) Label text inside row */
:where(.app > aside, .app > nav, .app [data-sidebar], .app .left-rail, .app .sidenav, .app .sidebar)
  :is(a, button, [role="button"], .row) :is(.label, span, strong) {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  font-size: 13.5px;
  line-height: 1;
}

/* 7) Hover + focus */
:where(.app > aside, .app > nav, .app [data-sidebar], .app .left-rail, .app .sidenav, .app .sidebar)
  :is(a, button, [role="button"], .row):hover {
  background: var(--sb-hover);
  border-color: color-mix(in oklab, var(--border), transparent 25%);
}
:where(.app > aside, .app > nav, .app [data-sidebar], .app .left-rail, .app .sidenav, .app .sidebar)
  :is(a, button, [role="button"], .row):focus-visible {
  outline: 2px solid color-mix(in oklab, var(--bubble-user-bg, #3b82f6), white 10%);
  outline-offset: 2px;
}

/* 8) Active row (supports either aria-current or a helper class) */
:where(.app > aside, .app > nav, .app [data-sidebar], .app .left-rail, .app .sidenav, .app .sidebar)
  :is(a[aria-current="page"], button[aria-current="page"], .row.is-active) {
  background: var(--sb-active);
  border-color: color-mix(in oklab, var(--bubble-user-bg, #3b82f6), transparent 75%);
  font-weight: 600;
}

/* 9) Muted “empty” state pill like “No history yet” */
:where(.app > aside, .app > nav, .app [data-sidebar], .app .left-rail, .app .sidenav, .app .sidebar)
  :is(.empty, [data-empty]) {
  color: color-mix(in oklab, var(--fg), transparent 55%);
  background: color-mix(in oklab, var(--fg), var(--bg) 96%);
  border: 1px dashed color-mix(in oklab, var(--border), transparent 15%);
}

/* 10) Divider */
:where(.app > aside, .app > nav, .app [data-sidebar], .app .left-rail, .app .sidenav, .app .sidebar)
  :is(hr, .sb-divider, [data-sb-divider]) {
  height: 1px;
  border: 0;
  margin: 8px var(--sb-pad-x);
  background: color-mix(in oklab, var(--border), transparent 20%);
}

/* 11) Dark mode tweaks for the sidebar */
@media (prefers-color-scheme: dark) {
  :where(.app > aside, .app > nav, .app [data-sidebar], .app .left-rail, .app .sidenav, .app .sidebar) {
    background: var(--sb-bg, color-mix(in oklab, var(--bg), white 3%));
  }
  :where(.app > aside, .app > nav, .app [data-sidebar], .app .left-rail, .app .sidenav, .app .sidebar)
    :is(a, button, [role="button"], .row):hover {
    background: color-mix(in oklab, var(--fg), var(--bg) 85%);
  }
}/* === TEMP PASS: first-column probe (high-specificity + !important) === */
:root .app > *:first-child { outline: 3px dashed fuchsia !important; }
:root .app > *:first-child a,
:root .app > *:first-child button,
:root .app > *:first-child [role="button"] {
  background: #fff7ed !important;       /* peach */
  outline: 2px solid #fb923c !important; /* orange */
}
/* === CSS pass #9: sidebar — exact selectors for your DOM (append-only) === */
:root{
  --sb-width: 264px;
  --sb-row-h: 38px;
  --sb-radius: 12px;
  --sb-pad-x: 12px;
  --sb-gap: 8px;
  --sb-hover: color-mix(in oklab, var(--fg), var(--bg) 92%);
  --sb-active: color-mix(in oklab, var(--bubble-user-bg, #3b82f6), var(--bg) 85%);
  --sb-section-fg: color-mix(in oklab, var(--fg), transparent 45%);
}

/* Ensure two-column layout when sidebar is present */
.app{ display:grid; grid-template-columns: var(--sb-width) 1fr; min-height:100dvh; }
@media (max-width:768px){ .app{ grid-template-columns:1fr; } }

/* Sidebar base */
.sidebar{
  /* keep your inline z-index/position as-is */
  background: var(--sb-bg, color-mix(in oklab, var(--bg), black 4%));
  border-right: 1px solid var(--sb-border, var(--border));
  padding: 12px;
  display:flex;
  flex-direction:column;
  gap: 10px;
}

/* Top/bottom groups */
.sidebar .side-top,
.sidebar .side-bottom{
  display:flex;
  flex-direction:column;
  gap: var(--sb-gap);
}

/* Brand row keeps breathing room */
.sidebar .brand{ padding: 2px var(--sb-pad-x) 6px; }

/* Primary button (New chat) — pill like ChatGPT */
.sidebar .btn{
  display:grid;
  grid-template-columns: 1fr auto;
  align-items:center;
  height: var(--sb-row-h);
  padding: 0 12px;
  border-radius: var(--sb-radius);
  border: 1px solid transparent;
  background: transparent;
  color: var(--fg);
  text-align:left;
  cursor:pointer;
  user-select:none;
  transition: background .18s ease, border-color .18s ease, color .18s ease, box-shadow .18s ease;
}
.sidebar .btn.primary{
  height: 40px;
  border-radius: 14px;
  font-weight: 600;
  background: color-mix(in oklab, var(--bubble-user-bg, #3b82f6), var(--bg) 92%);
  border-color: color-mix(in oklab, var(--bubble-user-bg, #3b82f6), transparent 80%);
}
.sidebar .btn:hover{
  background: var(--sb-hover);
  border-color: color-mix(in oklab, var(--border), transparent 25%);
}
.sidebar .btn.primary:hover{
  background: color-mix(in oklab, var(--bubble-user-bg, #3b82f6), var(--bg) 88%);
}
.sidebar .btn:focus-visible{
  outline:2px solid color-mix(in oklab, var(--bubble-user-bg, #3b82f6), white 10%);
  outline-offset:2px;
}

/* Chats section */
.sidebar .chat-list{
  display:grid;
  gap: 6px;
  padding: 0 var(--sb-pad-x);
}
.sidebar .chat-item{
  display:grid;
  grid-template-columns: 1fr auto;
  align-items:center;
  height: var(--sb-row-h);
  padding: 0 10px;
  border-radius: var(--sb-radius);
  color: var(--fg);
  background: transparent;
  border: 1px solid transparent;
  transition: background .18s ease, border-color .18s ease, color .18s ease;
}
.sidebar .chat-item:hover{
  background: var(--sb-hover);
  border-color: color-mix(in oklab, var(--border), transparent 25%);
}
.sidebar .chat-item.is-active,
.sidebar .chat-item[aria-current="page"]{
  background: var(--sb-active);
  border-color: color-mix(in oklab, var(--bubble-user-bg, #3b82f6), transparent 75%);
  font-weight: 600;
}

/* Muted empty state like “No history yet” */
.sidebar .chat-item:empty,
.sidebar .chat-item[data-empty],
.sidebar .chat-item:is(.empty){
  color: color-mix(in oklab, var(--fg), transparent 55%);
  background: color-mix(in oklab, var(--fg), var(--bg) 96%);
  border: 1px dashed color-mix(in oklab, var(--border), transparent 15%);
}

/* Divider helper if you add <hr> between groups */
.sidebar hr{
  height:1px; border:0; margin:8px var(--sb-pad-x);
  background: color-mix(in oklab, var(--border), transparent 20%);
}

/* Dark-mode polish for the sidebar */
@media (prefers-color-scheme: dark){
  .sidebar{
    background: var(--sb-bg, color-mix(in oklab, var(--bg), white 3%));
  }
  .sidebar .btn:hover,
  .sidebar .chat-item:hover{
    background: color-mix(in oklab, var(--fg), var(--bg) 85%);
  }
}
/* === CSS pass #9b: sidebar contrast + depth (append-only) === */

/* Background tone slightly darker than body */
.sidebar {
  background: color-mix(in oklab, var(--bg), black 6%);
  box-shadow: inset -1px 0 0 color-mix(in oklab, var(--border), transparent 20%);
}

/* Primary “New chat” pops more */
.sidebar .btn.primary {
  background: color-mix(in oklab, var(--bubble-user-bg, #3b82f6), var(--bg) 88%);
  border-color: color-mix(in oklab, var(--bubble-user-bg, #3b82f6), transparent 65%);
  color: #fff;
  font-weight: 600;
  letter-spacing: .01em;
}
.sidebar .btn.primary:hover {
  background: color-mix(in oklab, var(--bubble-user-bg, #3b82f6), var(--bg) 78%);
}

/* Regular buttons — lighter base, visible edge */
.sidebar .btn:not(.primary) {
  background: color-mix(in oklab, var(--bg), var(--fg) 4%);
  border: 1px solid color-mix(in oklab, var(--border), transparent 40%);
}
.sidebar .btn:not(.primary):hover {
  background: color-mix(in oklab, var(--fg), var(--bg) 90%);
}

/* Chat list section divider effect */
.sidebar .chat-list {
  padding-top: 8px;
  border-top: 1px solid color-mix(in oklab, var(--border), transparent 35%);
}

/* Empty history text muted but readable */
.sidebar .chat-item {
  color: color-mix(in oklab, var(--fg), transparent 25%);
}
.sidebar .chat-item:hover {
  background: color-mix(in oklab, var(--fg), var(--bg) 92%);
}

/* Dark-mode tweak for same depth */
@media (prefers-color-scheme: dark) {
  .sidebar {
    background: color-mix(in oklab, var(--bg), white 2%);
    box-shadow: inset -1px 0 0 color-mix(in oklab, var(--border), transparent 40%);
  }
  .sidebar .btn.primary {
    background: color-mix(in oklab, var(--bubble-user-bg, #3b82f6), black 70%);
  }
}
/* === CSS pass #9c: sidebar pills (high-specificity, append-only) === */

/* Layout stays two-column */
:root .app { display:grid; grid-template-columns: 264px 1fr; min-height:100dvh; }
@media (max-width:768px){ :root .app { grid-template-columns: 1fr; } }

/* Sidebar surface */
:root .sidebar{
  background: color-mix(in oklab, var(--bg), black 6%);
  border-right: 1px solid color-mix(in oklab, var(--border), transparent 20%);
  padding: 12px !important;
}

/* Pills: buttons and chat rows */
:root .sidebar .btn,
:root .sidebar .chat-item{
  display: grid !important;
  grid-template-columns: 1fr auto !important;  /* label | meta (optional) */
  align-items: center !important;
  height: 38px !important;
  padding: 0 12px !important;
  border-radius: 12px !important;
  border: 1px solid transparent !important;
  background: color-mix(in oklab, var(--bg), var(--fg) 4%) !important;
  color: var(--fg) !important;
  text-align: left !important;
  text-decoration: none !important;
  cursor: pointer !important;
  user-select: none !important;
  transition: background .18s ease, border-color .18s ease, color .18s ease !important;
  font-size: 13.5px !important;
  line-height: 1 !important;
}

/* Primary “New chat” */
:root .sidebar .btn.primary{
  height: 40px !important;
  border-radius: 14px !important;
  font-weight: 600 !important;
  color: #fff !important;
  background: color-mix(in oklab, var(--bubble-user-bg, #3b82f6), var(--bg) 82%) !important;
  border-color: color-mix(in oklab, var(--bubble-user-bg, #3b82f6), transparent 60%) !important;
}

/* Hover states */
:root .sidebar .btn:hover,
:root .sidebar .chat-item:hover{
  background: color-mix(in oklab, var(--fg), var(--bg) 90%) !important;
  border-color: color-mix(in oklab, var(--border), transparent 25%) !important;
}

/* Active/selected chat (supports helper class or aria) */
:root .sidebar .chat-item.is-active,
:root .sidebar .chat-item[aria-current="page"]{
  background: color-mix(in oklab, var(--bubble-user-bg, #3b82f6), var(--bg) 85%) !important;
  border-color: color-mix(in oklab, var(--bubble-user-bg, #3b82f6), transparent 75%) !important;
  font-weight: 600 !important;
}

/* Empty “No history yet” look */
:root .sidebar .chat-item:empty,
:root .sidebar .chat-item[data-empty]{
  color: color-mix(in oklab, var(--fg), transparent 45%) !important;
  background: color-mix(in oklab, var(--fg), var(--bg) 96%) !important;
  border: 1px dashed color-mix(in oklab, var(--border), transparent 20%) !important;
}

/* Dark mode depth */
@media (prefers-color-scheme: dark){
  :root .sidebar{
    background: color-mix(in oklab, var(--bg), white 2%);
    border-right: 1px solid color-mix(in oklab, var(--border), transparent 40%);
  }
  :root .sidebar .btn:hover,
  :root .sidebar .chat-item:hover{
    background: color-mix(in oklab, var(--fg), var(--bg) 85%) !important;
  }
}
/* === Sidebar pills: scoped + safe (final) === */

/* Surface (don’t touch layout) */
aside.sidebar {
  background: color-mix(in oklab, var(--bg), black 6%);
  border-right: 1px solid color-mix(in oklab, var(--border), transparent 25%);
  padding: 12px;
}

/* Buttons + chat rows share the pill look */
aside.sidebar .btn,
aside.sidebar .chat-item {
  height: 38px;
  padding: 0 12px;
  border-radius: 12px;
  border: 1px solid color-mix(in oklab, var(--border), transparent 25%);
  background: color-mix(in oklab, var(--bg), var(--fg) 4%);
  color: var(--fg);
  text-align: left;
  transition: background .18s ease, border-color .18s ease, color .18s ease;
}

/* Primary “New chat” pops a bit more */
aside.sidebar .btn.primary {
  height: 40px;
  border-radius: 14px;
  font-weight: 600;
  color: #fff;
  background: color-mix(in oklab, var(--bubble-user-bg, #3b82f6), var(--bg) 82%);
  border-color: color-mix(in oklab, var(--bubble-user-bg, #3b82f6), transparent 60%);
}

/* Hover states */
aside.sidebar .btn:hover,
aside.sidebar .chat-item:hover {
  background: color-mix(in oklab, var(--fg), var(--bg) 90%);
  border-color: color-mix(in oklab, var(--border), transparent 15%);
}

/* Active chat support (add .is-active or aria-current="page" when you have history) */
aside.sidebar .chat-item.is-active,
aside.sidebar .chat-item[aria-current="page"] {
  background: color-mix(in oklab, var(--bubble-user-bg, #3b82f6), var(--bg) 85%);
  border-color: color-mix(in oklab, var(--bubble-user-bg, #3b82f6), transparent 75%);
  font-weight: 600;
}

/* “No history yet” muted card */
aside.sidebar .chat-item:empty,
aside.sidebar .chat-item[data-empty],
aside.sidebar .chat-item.empty {
  color: color-mix(in oklab, var(--fg), transparent 45%);
  background: color-mix(in oklab, var(--fg), var(--bg) 96%);
  border: 1px dashed color-mix(in oklab, var(--border), transparent 20%);
}

/* Gentle separation above the list (optional) */
aside.sidebar .chat-list {
  padding-top: 8px;
  border-top: 1px solid color-mix(in oklab, var(--border), transparent 35%);
}

/* Dark mode depth tweaks */
@media (prefers-color-scheme: dark) {
  aside.sidebar {
    background: color-mix(in oklab, var(--bg), white 3%);
    border-right-color: color-mix(in oklab, var(--border), transparent 45%);
  }
  aside.sidebar .btn:hover,
  aside.sidebar .chat-item:hover {
    background: color-mix(in oklab, var(--fg), var(--bg) 85%);
  }
}
/* === Sidebar drawer wiring (append-only) === */

/* Hamburger: only show on mobile; keep it out of flow */
.sb-hamburger {
  position: fixed;
  top: 10px;
  left: 10px;
  z-index: 1100;
  display: none;
  padding: 8px 10px;
  border-radius: 10px;
  background: color-mix(in oklab, var(--bg), var(--fg) 4%);
  border: 1px solid color-mix(in oklab, var(--border), transparent 25%);
  font-size: 18px;
  line-height: 1;
  cursor: pointer;
  user-select: none;
}
@media (max-width: 768px) {
  .sb-hamburger { display: inline-block; }
}

/* Base grid stays as-is */
.app { display: grid; grid-template-columns: var(--sb-width, 264px) 1fr; min-height: 100dvh; }
@media (max-width: 768px) {
  .app { grid-template-columns: 1fr; }
}

/* Mobile drawer behavior: slide-in left when #sb-toggle is checked */
@media (max-width: 768px) {
  /* drawer closed by default */
  .sidebar {
    position: fixed;
    inset: 0 auto 0 0;
    width: min(86vw, var(--sb-width, 264px));
    max-width: 92vw;
    transform: translateX(-100%);
    transition: transform 220ms cubic-bezier(.2,.8,.2,1), box-shadow 220ms cubic-bezier(.2,.8,.2,1);
    box-shadow: none;
  }

  /* backdrop via pseudo element on body */
  .app::after {
    content: "";
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.35);
    opacity: 0;
    pointer-events: none;
    transition: opacity 220ms cubic-bezier(.2,.8,.2,1);
  }

  /* when checked, open drawer + enable backdrop */
  #sb-toggle:checked ~ .sidebar {
    transform: translateX(0);
    box-shadow: 0 8px 24px rgba(0,0,0,.18);
  }
  #sb-toggle:checked ~ .content { pointer-events: none; }
  #sb-toggle:checked ~ .content * { pointer-events: none; }

  #sb-toggle:checked ~ .sidebar ~ .content::before,
  #sb-toggle:checked ~ .content::before { /* ensure stacking if needed */ }

  #sb-toggle:checked ~ .sidebar ~ .content,
  #sb-toggle:checked ~ .content { /* keeps layout steady */ }

  #sb-toggle:checked ~ .sidebar,
  #sb-toggle:checked ~ .content,
  #sb-toggle:checked ~ .sidebar ~ .content { /* noop hooks for specificity */ }

  /* backdrop visible when open */
  #sb-toggle:checked ~ .content::before { content: ""; }
  #sb-toggle:checked ~ .app::after {} /* noop for safety */
  #sb-toggle:checked ~ .sidebar,
  #sb-toggle:checked ~ .content { /* already handled above */ }

  /* Simpler: just toggle body backdrop via sibling combinator */
  #sb-toggle:checked ~ .sidebar ~ .content + * {}
  #sb-toggle:checked ~ .sidebar ~ .content {}
  #sb-toggle:checked ~ .sidebar {}
  #sb-toggle:checked ~ .content {}
  #sb-toggle:checked ~ .app::after {} /* (kept for clarity) */

  /* Practical backdrop without extra nodes: attach to body.app */
  #sb-toggle:checked ~ .content { position: relative; }
  #sb-toggle:checked ~ .content::after {
    content: "";
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.35);
    pointer-events: auto;
  }
}

/* Optional: click backdrop to close (pointer-events on ::after catch the click)
   You can add a tiny script later, but for now use the hamburger again to close. */

/* Keep the pill styling you already shipped */
